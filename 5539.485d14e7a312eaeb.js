"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5539],{5539:(D,g,c)=>{c.r(g),c.d(g,{PuntosModule:()=>L});var v=c(6895),y=c(1407),u=c(655),t=c(8256),a=c(4556),m=c(433);let f=(()=>{class i{constructor(e){this.modalCtrl=e,this.tipoDireccion="driving-traffic"}ngOnInit(){this.tipo&&(this.tipoDireccion=this.tipo),console.log(this.punto,"desde el modal")}indicaciones(){const{lat:e,lng:o}=this.punto.coordinates;this.modalCtrl.dismiss({direccion:this.tipoDireccion,lng:o,lat:e},"confirm"),console.log(this.tipoDireccion,"tipo de direccion")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(a.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-detalle-punto-page"]],inputs:{punto:"punto",tipo:"tipo"},decls:20,vars:5,consts:[["color","light"],[1,"container"],[1,"img",3,"src"],[1,"content-text"],["color","light","lines","none"],[2,"width","90%"],[3,"ngModel","ngModelChange"],["value","driving-traffic"],["name","car-outline"],["value","cycling"],["name","bicycle-outline"],["value","walking"],["name","walk-outline"],["expand","block",3,"click"],["name","locate-outline","slot","icon-only"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-content",0)(1,"div",1),t._UZ(2,"ion-img",2),t.TgZ(3,"div",3)(4,"ion-item",4)(5,"ion-label"),t._uU(6),t.ALo(7,"uppercase"),t.qZA()()(),t.TgZ(8,"div",5)(9,"ion-segment",6),t.NdJ("ngModelChange",function(r){return o.tipoDireccion=r}),t.TgZ(10,"ion-segment-button",7),t._UZ(11,"ion-icon",8),t.qZA(),t.TgZ(12,"ion-segment-button",9),t._UZ(13,"ion-icon",10),t.qZA(),t.TgZ(14,"ion-segment-button",11),t._UZ(15,"ion-icon",12),t.qZA()()(),t.TgZ(16,"div",5)(17,"ion-button",13),t.NdJ("click",function(){return o.indicaciones()}),t._UZ(18,"ion-icon",14),t._uU(19," \xa0 Indicaciones "),t.qZA()()()()),2&e&&(t.xp6(2),t.Q6J("src",o.punto.imagenURL),t.xp6(4),t.Oqu(t.lcZ(7,3,o.punto.nombre)),t.xp6(3),t.Q6J("ngModel",o.tipoDireccion))},dependencies:[a.YG,a.W2,a.gu,a.Xz,a.Ie,a.Q$,a.cJ,a.GO,a.QI,m.JJ,m.On,v.gd],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;flex-direction:column;gap:.7rem}.img[_ngcontent-%COMP%]{width:90%;height:200px;object-fit:cover;border-radius:10px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.2);margin-top:20px}.content-text[_ngcontent-%COMP%]{width:90%}.content-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:400}ion-segment[_ngcontent-%COMP%]{background-color:transparent;border:none}ion-segment-button[_ngcontent-%COMP%]{--background-checked: var(--ion-color-dark);--color-checked: var(--ion-color-primary);--border-radius:25px;--indicator-color: transparent !important}"]}),i})();var p=c(9898),M=c(2340),h=c(6090),P=c(529);let b=(()=>{class i{constructor(e){this.httpclient=e,this.mapbox=p,this.mapbox.accessToken=M.N.KeyMapBox}crearMapa(e){this.map=new p.Map({container:e,style:"mapbox://styles/mapbox/streets-v12",zoom:11.5,center:[-64.73349858433076,-21.53250712718626],pitch:60}),this.map.addControl(new p.NavigationControl),this.map.on("load",()=>{this.map.resize()})}cargarData(){return(0,u.mG)(this,void 0,void 0,function*(){return(yield this.httpclient.get("./assets/rutas/puntos.json").toPromise()).puntos})}calcularRuta(e,o,n){return fetch(`https://api.mapbox.com/directions/v5/mapbox/${n}/${e[0]},${e[1]};${o[0]},${o[1]}?steps=true&geometries=geojson&access_token=${p.accessToken}`,{method:"GET"})}createMarker(e,o){return new p.Marker({element:e}).setLngLat(o).addTo(this.map)}printLine(e){this.map.getLayer("layerLinea")&&(this.map.removeLayer("layerLinea"),this.map.removeLayer("arrow-layer"),this.map.removeImage("arrow-id"),this.map.removeSource("ruta")),this.map.loadImage("assets/icon/arrow.png",(o,n)=>{if(o)throw o;this.map.addImage("arrow-id",n),this.map.addSource("ruta",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e}}}),this.map.addLayer({id:"layerLinea",type:"line",source:"ruta",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#7B47F4","line-width":10,"line-blur":1}}),this.map.addLayer({id:"arrow-layer",type:"symbol",source:"ruta",layout:{"symbol-placement":"line","symbol-spacing":25,"icon-image":"arrow-id","icon-size":1}})}),this.zoomRuta(e)}createPopUp(){return new p.Popup}location(){return h.b.getCurrentPosition({enableHighAccuracy:!0})}checkPermisos(){return h.b.checkPermissions()}solicitarPermisos(){return h.b.requestPermissions({permissions:["location"]})}deleteMarker(e){e.remove()}deleteLine(){this.map.getLayer("layerLinea")&&(this.map.removeLayer("layerLinea"),this.map.removeLayer("arrow-layer"),this.map.removeImage("arrow-id"),this.map.removeSource("ruta"))}zoomRuta(e){const o=new p.LngLatBounds(e[0],e[e.length-1]);for(const n of e)o.extend(n);this.map.fitBounds(o,{padding:{top:60,bottom:100,left:40,right:40}})}deletePopup(e){e.remove()}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(P.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const C=[{path:"",component:(()=>{class i{constructor(e,o,n,r,s){this._puntosService=e,this.renderer=o,this.toastCtrl=n,this.loadingCtrl=r,this.modalCtrl=s}ngOnInit(){this._puntosService.crearMapa("map"),this.cargarInfo()}cargarInfo(){this._puntosService.cargarData().then(e=>{e.forEach(o=>{const n=this.renderer.createElement("div");this.renderer.addClass(n,"marker"),this.renderer.setStyle(n,"backgroundImage",`url(${o.imagenURL})`);const{lng:r,lat:s}=o.coordinates;this._puntosService.createMarker(n,[r,s]).getElement().addEventListener("click",()=>{this.openModal(o)})})})}calcularRuta(e,o,n){return(0,u.mG)(this,void 0,void 0,function*(){const s=yield(yield this._puntosService.calcularRuta(e,o,n)).json();this._puntosService.printLine(s.routes[0].geometry.coordinates),yield this.loading.dismiss(),this._puntosService.map.on("click","layerLinea",d=>{this.popupDetalle&&this._puntosService.deletePopup(this.popupDetalle);const{lat:S,lng:x}=d.lngLat;this.popupDetalle=this._puntosService.createPopUp().setLngLat([x,S]).setHTML(`\n        <div style="color:black">\n          <p>\n            <span>Distancia:${this.formatDistanceFromMeters(s.routes[0].distance)}</span>\n          </p>\n          <p>\n            <span>Duracion:${this.formatTimeFromSeconds(s.routes[0].duration)}</span>\n          </p>\n        </div>\n        `).addTo(this._puntosService.map)})})}ubicacion(e,o){this._puntosService.checkPermisos().then(()=>{this._puntosService.solicitarPermisos().then(n=>{"granted"==n.location?(this.presentLoading(),this._puntosService.location().then(r=>{const{latitude:s,longitude:d}=r.coords;this.markerOrigen&&this._puntosService.deleteMarker(this.markerOrigen),this.markerOrigen=this._puntosService.createMarker(null,[d,s]),this.calcularRuta([d,s],e,o)}).catch(r=>{this.mensaje("Error al conseguir tu ubicacion","close-circle-outline")})):"denied"==n.location&&this.mensaje("Se denego el permiso de ubicacion","close-circle-outline")}).catch(n=>{this.mensaje("requerimiento de permisos no implementado para web","close-circle-outline"),console.log(n.message)})}).catch(n=>{this.mensaje("gps no esta activo","close-circle-outline"),console.log(n.message)})}mensaje(e,o){return(0,u.mG)(this,void 0,void 0,function*(){(yield this.toastCtrl.create({message:e,icon:o,duration:2e3})).present()})}presentLoading(){return(0,u.mG)(this,void 0,void 0,function*(){this.loading=yield this.loadingCtrl.create({message:"Buscando Ruta...",spinner:"lines-sharp"}),yield this.loading.present()})}openModal(e){return(0,u.mG)(this,void 0,void 0,function*(){const o=yield this.modalCtrl.create({component:f,breakpoints:[0,.55,.6],handleBehavior:"cycle",initialBreakpoint:.55,componentProps:{punto:e,tipo:this.TipoDireccion}});yield o.present();const n=yield o.onDidDismiss();"confirm"===n.role&&(this.ubicacion([n.data.lng,n.data.lat],n.data.direccion),this.TipoDireccion=n.data.direccion)})}formatTimeFromSeconds(e){const o=Math.floor(e/60),n=Math.floor(o/60);if(n>0){const r=o-60*n;return`${n} hora${n>1?"s":""} y ${r} minuto${r>1?"s":""}`}return`${o} minuto${o>1?"s":""}`}formatDistanceFromMeters(e){const o=Math.floor(e/1e3),n=Math.round(e%1e3);return o>0?`${o} kil\xf3metro${o>1?"s":""} y ${n} metro${n>1?"s":""}`:`${n} metro${n>1?"s":""}`}ubicacionsinpermisos(e,o){this._puntosService.location().then(n=>{const{latitude:r,longitude:s}=n.coords;this.markerOrigen=this._puntosService.createMarker(null,[s,r]),this.calcularRuta([s,r],e,o)}).catch(n=>{this.mensaje("Error al conseguir tu ubicacion","close-circle-outline")})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(b),t.Y36(t.Qsj),t.Y36(a.yF),t.Y36(a.HT),t.Y36(a.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-puntos-page"]],decls:1,vars:0,consts:[["id","map"]],template:function(e,o){1&e&&t._UZ(0,"div",0)},styles:["#map[_ngcontent-%COMP%]{width:100%;height:100vh}.marker[_ngcontent-%COMP%]{display:block;border-radius:50%;border:3px solid white;cursor:pointer;padding:0;width:50px;height:50px;background-size:cover}"]}),i})()},{path:"detalle",component:f}];let k=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[y.Bz.forChild(C),y.Bz]}),i})(),L=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[v.ez,k,P.JF,a.Pc,m.u5]}),i})()}}]);